<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>Neo4j-Cypher语言语法 | vic的博客</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="前端博客, 前端, 程序员, 前端开发, 全栈开发, node.js, javascript"><meta name="description" content="日常学习与兴趣交流"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://fuyong.net.cn/2018/03/15/Neo4j-Cypher语言语法/index.html"><link rel="icon" type="image/png" href="/img/favicon.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="vic的博客"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(/img/loading.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="vic的博客" alt="vic的博客"><img src="/img/logo.png" alt="vic的博客"></a><nav class="page__nav"><ul class="nav__list clearfix"></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="/img/banner-bg.png" alt="Neo4j-Cypher语言语法"></div><header class="post__info"><h1 class="post__title">Neo4j-Cypher语言语法</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/">undefined</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2018-03-15</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/Neo4j/">Neo4j</a></li></ul></div></div></header><div class="post__content"><p>本文是记录Neo4j图数据库中实用的Cypher语言语法。</p><h2 id="Cypher是什么"><a href="#Cypher是什么" class="headerlink" title="Cypher是什么"></a>Cypher是什么</h2><p>“Cypher”是一个描述性的类Sql的图操作语言。相当于关系数据库的Sql，可见其重要性。其语法针对图的特点而设计，非常方便和灵活。</p><ul><li>Cypher是一个申明式查询语言，适合于开发者和在数据库上做点对点模式（ad-hoc）查询。</li><li>Cypher通过一系列不同的方法和建立于确定的实践为表达查询而激发的。许多关键字如</li><li>like和order by是受SQL的启发。正则表达式匹配实现模仿Scala 语言。<br>学好Cypher是学好Neo4j的关键，也是核心所在！</li></ul><h2 id="Cypher语法"><a href="#Cypher语法" class="headerlink" title="Cypher语法"></a>Cypher语法</h2><h3 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE (erzi:Person &#123;id:‘erzi’&#125;), //erzi是别名</span><br><span class="line">(baba:Person &#123;id:&apos;baba&apos;&#125;),</span><br><span class="line">(yeye:Person &#123;id:&apos;yeye&apos;,name:&apos;zhangsan&apos;&#125;),</span><br><span class="line">(nainai:Person &#123;id:&apos;nainai&apos;&#125;),</span><br><span class="line">(mama:Person &#123;id:&apos;mama&apos;&#125;),</span><br><span class="line">(bozi:Person &#123;id:&apos;bozi&apos;&#125;),</span><br><span class="line">// 创建关系</span><br><span class="line">(erzi)-[:fathor]-&gt;(baba),</span><br><span class="line">(baba)-[:fathor]-&gt;(yeye),</span><br><span class="line">(baba)-[:mother]-&gt;(nainai),</span><br><span class="line">(erzi)-[:mother]-&gt;(mama),</span><br><span class="line">(erzi)-[:girlFrend]-&gt;(bozi)</span><br></pre></td></tr></table></figure><h3 id="Match"><a href="#Match" class="headerlink" title="Match"></a>Match</h3><p><code>match</code>相当于sql中的select<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (n:Person) RETURN n limit 25</span><br></pre></td></tr></table></figure><p></p><p>等价于：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Select * from Person limit 25</span><br></pre></td></tr></table></figure><p></p><h3 id="Merge"><a href="#Merge" class="headerlink" title="Merge"></a>Merge</h3><p><code>merge</code> 相当于Match or Create 有则match，无则Create<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MERGE (n:Person &#123; name: &apos;Ann&apos; &#125;) RETURN n</span><br></pre></td></tr></table></figure><p></p><p>下面这两条语句的对比？<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">match (n:Person &#123;id:&apos;mama&apos;&#125;),(m:Person &#123;id:&apos;nainai&apos;&#125;) merge (n)-[:poxi]-&gt;(m) return n,m</span><br><span class="line">和</span><br><span class="line">match (n:Person &#123;id:&apos;mama&apos;&#125;) with n match (m:Person &#123;id:&apos;nainai&apos;&#125;) merge (n)-[:poxi]-&gt;(m) return n,m</span><br></pre></td></tr></table></figure><p></p><h3 id="Delete-和-Remove"><a href="#Delete-和-Remove" class="headerlink" title="Delete 和 Remove"></a>Delete 和 Remove</h3><p>DELETE和REMOVE主要区别 :<br>DELETE操作用于删除节点和relation。<br>REMOVE操作用于删除标签label和属性。<br>Remove label 等同于drop table<br>两个命令都应该与MATCH命令一起使用。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Match (n:Person &#123;id:&apos;baba&apos;&#125;) remove n.age return n</span><br><span class="line">MATCH (s:Teacher)-[r:teach]-&gt;(d:Student) delete r,s,d //删除与该关系相关的老师和学生及label</span><br><span class="line">MATCH (n:Test) remove n:Test //删除label</span><br></pre></td></tr></table></figure><p>如何仅仅删除一个relation？<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Match (a:Person),(b:Person) where a.id=&apos;erzi&apos; and b.id=&apos;bozi&apos; merge (a)-[r:FUQI]-&gt;(b) DELETE r</span><br></pre></td></tr></table></figure><p></p><h3 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h3><p><code>order by</code> 同sql</p><h3 id="Limit-和-Skip"><a href="#Limit-和-Skip" class="headerlink" title="Limit 和 Skip"></a>Limit 和 Skip</h3><p><code>limit</code>：显示多少行<br><code>skip</code>：从最前面开始，跳过多少行</p><h3 id="Union-和-Union-all"><a href="#Union-和-Union-all" class="headerlink" title="Union 和 Union all"></a>Union 和 Union all</h3><p><code>Union</code>：把多段Match的return结果 上线组合成一个结果集，会自动去掉重复行；<br><code>Union all</code>：作用同union，但不去重；</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MATCH (n:Person) where n.age&gt;20 RETURN n.id,n.age</span><br><span class="line">union all</span><br><span class="line">MATCH (n:Person) where n.id=&apos;erzi&apos; RETURN n.id,n.age</span><br></pre></td></tr></table></figure><h3 id="In"><a href="#In" class="headerlink" title="In"></a>In</h3><p>和sql的区别就是使用[]中括号，而不是()括弧号<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (n:Person) where n.age&gt;20 RETURN n.id,n.age union all MATCH (n:Person) where n.id in [&apos;erzi&apos;,&apos;bozi&apos;,&apos;baba&apos;] RETURN n.id,n.age</span><br></pre></td></tr></table></figure><p></p><h2 id="Cypher-索引"><a href="#Cypher-索引" class="headerlink" title="Cypher 索引"></a>Cypher 索引</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create index on:Person(id)</span><br><span class="line">drop index on:Person(id)</span><br></pre></td></tr></table></figure><p>注意：</p><ul><li>创建索引时不需要给索引起名称，只需要设置索引的字段即可</li><li>通过该字段的查询都走索引 where in =</li></ul><h2 id="唯一约束-Constraint"><a href="#唯一约束-Constraint" class="headerlink" title="唯一约束 Constraint"></a>唯一约束 Constraint</h2><p>给某个属性设置唯一约束<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create constraint on (n:Person) assert n.id is unique</span><br><span class="line">drop constraint on (n:Person) assert n.id is unique</span><br></pre></td></tr></table></figure><p></p><h2 id="执行计划-explain"><a href="#执行计划-explain" class="headerlink" title="执行计划 explain"></a>执行计划 explain</h2><p>类似sql</p><p><img src="$res/1512897788760.jpg" alt="1512897788760"></p><h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><blockquote><p>Neo4j无 group by</p><ul><li><code>UPPER</code> 它用于将所有字母更改为大写字母。</li><li><code>LOWER</code> 它用于将所有字母改为小写字母。</li><li><code>SUBSTRING</code> 它用于获取给定String的子字符串。</li><li><code>REPLACE</code> 它用于替换一个字符串的子字符串。<br>Match (n:Person) return SUBSTRING(n.id,2,0),n.id</li></ul></blockquote><p><strong>聚集函数</strong></p><ul><li><code>COUNT</code> 它返回由MATCH命令返回的行数。</li><li><code>MAX</code> 它从MATCH命令返回的一组行返回最大值。</li><li><code>MIN</code> 它返回由MATCH命令返回的一组行的最小值。</li><li><code>SUM</code> 它返回由MATCH命令返回的所有行的求和值。</li><li><code>AVG</code> 它返回由MATCH命令返回的所有行的平均值。<br>Match (n:Person) return count(*)<br>Match (n:Person) return avg(n.age) 只包含age不为空的node</li></ul><p><strong>查询最短路径</strong></p><blockquote><p>查询最短路径的必要性：6层关系理论：任何两个事物之间的关系都不会超过6层。<br>关系链路越短，代表这两个节点的关系越密切！</p></blockquote><p><code>allShortestPaths</code> [*..n] 用于表示获取n层关系,显示所有的链路关系（Single shortest path）<br><code>shortestPath</code> 显示最短的链路（Single shortest path）</p><p><code>match p=allshortestPaths((n:Person {id:&#39;mama&#39;})-[*..3]-(b:Person {id:&#39;nainai&#39;})) return p match p=shortestPath((n:Person {id:&#39;mama&#39;})-[*..3]-(b:Person {id:&#39;nainai&#39;})) return p</code>-</p><div class="post-announce">感谢您的阅读，本文由 <a href="http://fuyong.net.cn">vic的博客</a> 版权所有。如若转载，请注明出处：vic的博客（<a href="http://fuyong.net.cn/2018/03/15/Neo4j-Cypher语言语法/">http://fuyong.net.cn/2018/03/15/Neo4j-Cypher语言语法/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2018/03/15/hexo-readme/" title="Hello Hexo!"><i class="iconfont icon-prev"></i>Hello Hexo!</a></div><div class="post__prev post__prev--right"><a href="/2018/03/18/Nginx系列 一   配置介绍/" title="Nginx系列<一>  配置介绍">Nginx系列<一>配置介绍<i class="iconfont icon-next"></i></一></a></div></div></div></article></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">日常学习与兴趣交流</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/感悟/">感悟</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/工具/">工具</a><span class="block-list-count">5</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/工作记录/">工作记录</a><span class="block-list-count">5</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/学习记录/">学习记录</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/Java/">Java</a><span class="block-list-count">3</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2020/03/01/Python包管理/" title="Python包管理"><div class="item__cover"><img src="/img/banner-bg.png" alt="Python包管理"></div><div class="item__info"><h3 class="item__title">Python包管理</h3><span class="item__text">2020-03-01</span></div></a></li><li class="latest-post-item"><a href="/2018/03/28/Intellij IDEA快捷键介绍-常用篇/" title="Intellij IDEA快捷键介绍-常用篇"><div class="item__cover"><img src="/img/banner-bg.png" alt="Intellij IDEA快捷键介绍-常用篇"></div><div class="item__info"><h3 class="item__title">Intellij IDEA快捷键介绍-常用篇</h3><span class="item__text">2018-03-28</span></div></a></li><li class="latest-post-item"><a href="/2018/03/18/Nginx系列 一   配置介绍/" title="Nginx系列<一>  配置介绍"><div class="item__cover"><img src="/img/banner-bg.png" alt="Nginx系列<一>  配置介绍"></div><div class="item__info"><h3 class="item__title">Nginx系列<一>配置介绍</一></h3><span class="item__text">2018-03-18</span></div></a></li><li class="latest-post-item"><a href="/2018/03/15/Neo4j-Cypher语言语法/" title="Neo4j-Cypher语言语法"><div class="item__cover"><img src="/img/banner-bg.png" alt="Neo4j-Cypher语言语法"></div><div class="item__info"><h3 class="item__title">Neo4j-Cypher语言语法</h3><span class="item__text">2018-03-15</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/Intellij-IDEA/">Intellij IDEA</a></li><li class="tag-item"><a class="tag-link" href="/tags/Intellij-IDEA-Upsource/">Intellij IDEA Upsource</a></li><li class="tag-item"><a class="tag-link" href="/tags/Jasypt/">Jasypt</a></li><li class="tag-item"><a class="tag-link" href="/tags/Java/">Java</a></li><li class="tag-item"><a class="tag-link" href="/tags/Linux-vim/">Linux vim</a></li><li class="tag-item"><a class="tag-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-item"><a class="tag-link" href="/tags/Neo4j/">Neo4j</a></li><li class="tag-item"><a class="tag-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-item"><a class="tag-link" href="/tags/python/">python</a></li><li class="tag-item"><a class="tag-link" href="/tags/学习方法/">学习方法</a></li><li class="tag-item"><a class="tag-link" href="/tags/感悟/">感悟</a></li><li class="tag-item"><a class="tag-link" href="/tags/金融/">金融</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">分享日常学习、生活及工作的一些心得总结，欢迎点击右下角订阅 rss。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Shenzhen, Guangdong Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>fuyungcn@gmail.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="/img/qrcode.png" alt="logo" title="vic的博客"></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://github.com/Mrminfive/hexo-theme-skapp" title="hexo-theme-skapp" target="_blank">hexo-theme-skapp</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog Framework" target="_blank">Hexo</a></li><li class="list-item"><a href="https://github.com/Mrminfive/hexo-theme-skapp" title="hexo-theme-skapp" target="_blank">hexo-theme-skapp</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/FuYung" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:fuyungcn@gmail.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>